/*! jquery.tokeninput v1.8.0 */
!function(t){function e(t){return String(null===t||void 0===t?"":t)}function n(t){return e(t).replace(d,function(t){return l[t]})}var a={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",excludeCurrent:!1,excludeCurrentParameter:"x",accentInsensitive:!1,prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&#215;",animateDropdown:!0,placeholder:null,theme:null,zindex:999,resultsLimit:null,enableHTML:!1,resultsFormatter:function(t){var e=t[this.propertyToSearch];return"<li>"+(this.enableHTML?e:n(e))+"</li>"},tokenFormatter:function(t){var e=t[this.propertyToSearch];return"<li><p>"+(this.enableHTML?e:n(e))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",allowFreeTagging:!1,allowTabOut:!1,autoSelectFirstResult:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},s={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},i={BEFORE:0,AFTER:1,END:2},o={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},d=/[&<>"'\/]/g,r={init:function(e,n){var s=t.extend({},a,n||{});return this.each(function(){t(this).data("settings",s),t(this).data("tokenInputObject",new t.TokenList(this,e,s))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(t){return this.data("tokenInputObject").add(t),this},remove:function(t){return this.data("tokenInputObject").remove(t),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(t){return this.data("tokenInputObject").toggleDisabled(t),this},setOptions:function(e){return t(this).data("settings",t.extend({},t(this).data("settings"),e||{})),this},destroy:function(){if(this.data("tokenInputObject")){this.data("tokenInputObject").clear();var t=this,e=this.parent();return e.empty(),t.show(),e.append(t),t}}};t.fn.tokenInput=function(t){return r[t]?r[t].apply(this,Array.prototype.slice.call(arguments,1)):r.init.apply(this,arguments)},t.TokenList=function(e,a,l){function d(a){return t(e).data("settings").enableHTML?a:n(a)}function r(n){"boolean"==typeof n?t(e).data("settings").disabled=n:t(e).data("settings").disabled=!t(e).data("settings").disabled,z.attr("disabled",t(e).data("settings").disabled),K.toggleClass(t(e).data("settings").classes.disabled,t(e).data("settings").disabled),U&&k(t(U),i.END),G.attr("disabled",t(e).data("settings").disabled)}function u(){return null!==t(e).data("settings").tokenLimit&&V>=t(e).data("settings").tokenLimit?(z.hide(),void y()):void 0}function c(){if(B!==(B=z.val())){var t=K.width()-z.offset().left-K.offset().left;J.html(n(B)||n(l.placeholder)),z.width(Math.min(K.width(),Math.max(t,J.width()+30)))}}function g(){var n=t.trim(z.val()),a=n.split(t(e).data("settings").tokenDelimiter);t.each(a,function(n,a){if(a){t.isFunction(t(e).data("settings").onFreeTaggingAdd)&&(a=t(e).data("settings").onFreeTaggingAdd.call(G,a));var s={};s[t(e).data("settings").tokenValue]=s[t(e).data("settings").propertyToSearch]=a,h(s)}})}function p(n){var a=t(t(e).data("settings").tokenFormatter(n)),s=n.readonly===!0;s&&a.addClass(t(e).data("settings").classes.tokenReadOnly),a.addClass(t(e).data("settings").classes.token).insertBefore($),s||t("<span>"+t(e).data("settings").deleteText+"</span>").addClass(t(e).data("settings").classes.tokenDelete).appendTo(a).click(function(){return t(e).data("settings").disabled?void 0:(m(t(this).parent()),G.change(),!1)});var i=n;return t.data(a.get(0),"tokeninput",n),H=H.slice(0,W).concat([i]).concat(H.slice(W)),W++,T(H,G),V+=1,null!==t(e).data("settings").tokenLimit&&V>=t(e).data("settings").tokenLimit&&(z.hide(),y()),a}function h(n){var a=t(e).data("settings").onAdd;if(V>0&&t(e).data("settings").preventDuplicates){var s=null;if(K.children().each(function(){var e=t(this),a=t.data(e.get(0),"tokeninput");return a&&a[l.tokenValue]===n[l.tokenValue]?(s=e,!1):void 0}),s)return f(s),$.insertAfter(s),void j(z)}z.width(1),(null==t(e).data("settings").tokenLimit||V<t(e).data("settings").tokenLimit)&&(p(n),z.attr("placeholder",null),u()),z.val(""),y(),t.isFunction(a)&&a.call(G,n)}function f(n){t(e).data("settings").disabled||(n.addClass(t(e).data("settings").classes.selectedToken),U=n.get(0),z.val(""),y())}function k(n,a){n.removeClass(t(e).data("settings").classes.selectedToken),U=null,a===i.BEFORE?($.insertBefore(n),W--):a===i.AFTER?($.insertAfter(n),W++):($.appendTo(K),W=V),j(z)}function v(e){var n=U;U&&k(t(U),i.END),n===e.get(0)?k(e,i.END):f(e)}function m(n){var a=t.data(n.get(0),"tokeninput"),s=t(e).data("settings").onDelete,i=n.prevAll().length;i>W&&i--,n.remove(),U=null,j(z),H=H.slice(0,i).concat(H.slice(i+1)),0==H.length&&z.attr("placeholder",l.placeholder),W>i&&W--,T(H,G),V-=1,null!==t(e).data("settings").tokenLimit&&(z.show().val(""),j(z)),t.isFunction(s)&&s.call(G,a)}function T(n,a){var s=t.map(n,function(n){return"function"==typeof t(e).data("settings").tokenValue?t(e).data("settings").tokenValue.call(this,n):n[t(e).data("settings").tokenValue]});a.val(s.join(t(e).data("settings").tokenDelimiter))}function y(){Q.hide().empty(),q=null}function C(){Q.css({position:"absolute",top:K.offset().top+K.outerHeight(!0),left:K.offset().left,width:K.width(),"z-index":t(e).data("settings").zindex}).show()}function b(){t(e).data("settings").searchingText&&(Q.html("<p>"+d(t(e).data("settings").searchingText)+"</p>"),C())}function w(){t(e).data("settings").hintText&&(Q.html("<p>"+d(t(e).data("settings").hintText)+"</p>"),C())}function E(t){return t.replace(Y,"\\$&")}function x(t){var e=t;return e=e.replace(/[aãáàâ]/gi,"[aãáàâ]"),e=e.replace(/[eẽéèê]/gi,"[eẽéèê]"),e=e.replace(/[iĩíìî]/gi,"[iĩíìî]"),e=e.replace(/[oõóòô]/gi,"[oõóòô]"),e=e.replace(/[uũúùû]/gi,"[uũúùû]"),e=e.replace(/[cç]/gi,"[cç]")}function D(n,a){var s=E(a);return t(e).data("settings").accentInsensitive&&(s=x(s)),n.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+s+")(?![^<>]*>)(?![^&;]+;)","gi"),function(t,e){return"<b>"+d(e)+"</b>"})}function R(t,e,n){return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+E(e)+")(?![^<>]*>)(?![^&;]+;)","g"),D(e,n))}function F(n){if(t(e).data("settings").excludeCurrent){var a=t(e).data("tokenInputObject").getTokens(),s=[];a.length&&(t.each(n,function(n,i){var o=!0;t.each(a,function(n,a){return i[t(e).data("settings").propertyToSearch]==a[t(e).data("settings").propertyToSearch]?(o=!1,!1):void 0}),o&&s.push(i)}),n=s)}return n}function L(n,a){if(a=F(a),a&&a.length){Q.empty();var s=t("<ul/>").appendTo(Q).mouseover(function(e){O(t(e.target).closest("li"))}).mousedown(function(e){return h(t(e.target).closest("li").data("tokeninput")),G.change(),!1}).hide();t(e).data("settings").resultsLimit&&a.length>t(e).data("settings").resultsLimit&&(a=a.slice(0,t(e).data("settings").resultsLimit)),t.each(a,function(a,i){var o=t(e).data("settings").resultsFormatter(i);o=R(o,i[t(e).data("settings").propertyToSearch],n),o=t(o).appendTo(s),a%2?o.addClass(t(e).data("settings").classes.dropdownItem):o.addClass(t(e).data("settings").classes.dropdownItem2),0===a&&t(e).data("settings").autoSelectFirstResult&&O(o),t.data(o.get(0),"tokeninput",i)}),C(),t(e).data("settings").animateDropdown?s.slideDown("fast"):s.show()}else t(e).data("settings").noResultsText&&(Q.html("<p>"+d(t(e).data("settings").noResultsText)+"</p>"),C())}function O(n){n&&(q&&A(t(q)),n.addClass(t(e).data("settings").classes.selectedDropdownItem),q=n.get(0))}function A(n){n.removeClass(t(e).data("settings").classes.selectedDropdownItem),q=null}function P(){var n=z.val();n&&n.length&&(U&&k(t(U),i.AFTER),n.length>=t(e).data("settings").minChars?(b(),clearTimeout(M),M=setTimeout(function(){S(n)},t(e).data("settings").searchDelay)):y())}function S(n){var a=n+I(),s=_.get(a);if(s)t.isFunction(t(e).data("settings").onCachedResult)&&(s=t(e).data("settings").onCachedResult.call(G,s)),L(n,s);else if(t(e).data("settings").url){var i=I(),o={};if(o.data={},i.indexOf("?")>-1){var d=i.split("?");o.url=d[0];var r=d[1].split("&");t.each(r,function(t,e){var n=e.split("=");o.data[n[0]]=n[1]})}else o.url=i;if(o.data[t(e).data("settings").queryParam]=n,o.type=t(e).data("settings").method,o.dataType=t(e).data("settings").contentType,t(e).data("settings").crossDomain&&(o.dataType="jsonp"),t(e).data("settings").excludeCurrent){var u=t(e).data("tokenInputObject").getTokens(),c=t.map(u,function(n){return"function"==typeof t(e).data("settings").tokenValue?t(e).data("settings").tokenValue.call(this,n):n[t(e).data("settings").tokenValue]});o.data[t(e).data("settings").excludeCurrentParameter]=c.join(t(e).data("settings").tokenDelimiter)}o.success=function(s){_.add(a,t(e).data("settings").jsonContainer?s[t(e).data("settings").jsonContainer]:s),t.isFunction(t(e).data("settings").onResult)&&(s=t(e).data("settings").onResult.call(G,s)),z.val()===n&&L(n,t(e).data("settings").jsonContainer?s[t(e).data("settings").jsonContainer]:s)},l.onSend&&l.onSend(o),t.ajax(o)}else if(t(e).data("settings").local_data){var g=t.grep(t(e).data("settings").local_data,function(a){return a[t(e).data("settings").propertyToSearch].toLowerCase().indexOf(n.toLowerCase())>-1});_.add(a,g),t.isFunction(t(e).data("settings").onResult)&&(g=t(e).data("settings").onResult.call(G,g)),L(n,g)}}function I(){var n=t(e).data("settings");return"function"==typeof n.url?n.url.call(n):n.url}function j(t){setTimeout(function(){t.focus()},50)}if("string"==typeof a||"function"==typeof a){t(e).data("settings").url=a;var N=I();void 0===t(e).data("settings").crossDomain&&"string"==typeof N&&(-1===N.indexOf("://")?t(e).data("settings").crossDomain=!1:t(e).data("settings").crossDomain=location.href.split(/\/+/g)[1]!==N.split(/\/+/g)[1])}else"object"==typeof a&&(t(e).data("settings").local_data=a);t(e).data("settings").classes?t(e).data("settings").classes=t.extend({},s,t(e).data("settings").classes):t(e).data("settings").theme?(t(e).data("settings").classes={},t.each(s,function(n,a){t(e).data("settings").classes[n]=a+"-"+t(e).data("settings").theme})):t(e).data("settings").classes=s;var M,B,H=[],V=0,_=new t.TokenList.Cache,z=t('<input type="text" autocomplete="off" autocapitalize="off"/>').css({outline:"none"}).attr("id",t(e).data("settings").idPrefix+e.id).focus(function(){return t(e).data("settings").disabled?!1:(null!==t(e).data("settings").tokenLimit&&t(e).data("settings").tokenLimit===V||w(),void K.addClass(t(e).data("settings").classes.focused))}).blur(function(){y(),t(e).data("settings").allowFreeTagging&&g(),t(this).val(""),K.removeClass(t(e).data("settings").classes.focused)}).bind("keyup keydown blur update",c).keydown(function(n){var a,s;switch(n.keyCode){case o.LEFT:case o.RIGHT:case o.UP:case o.DOWN:if(0===this.value.length)a=$.prev(),s=$.next(),a.length&&a.get(0)===U||s.length&&s.get(0)===U?n.keyCode===o.LEFT||n.keyCode===o.UP?k(t(U),i.BEFORE):k(t(U),i.AFTER):n.keyCode!==o.LEFT&&n.keyCode!==o.UP||!a.length?n.keyCode!==o.RIGHT&&n.keyCode!==o.DOWN||!s.length||f(t(s.get(0))):f(t(a.get(0)));else{var l=null;n.keyCode===o.DOWN||n.keyCode===o.RIGHT?(l=t(Q).find("li").first(),q&&(l=t(q).next())):(l=t(Q).find("li").last(),q&&(l=t(q).prev())),O(l)}break;case o.BACKSPACE:if(a=$.prev(),0===this.value.length)return U?(m(t(U)),G.change()):a.length&&f(t(a.get(0))),!1;1===t(this).val().length?y():setTimeout(function(){P()},5);break;case o.TAB:case o.ENTER:case o.NUMPAD_ENTER:case o.COMMA:if(q)h(t(q).data("tokeninput")),G.change();else{if(t(e).data("settings").allowFreeTagging){if(t(e).data("settings").allowTabOut&&""===t(this).val())return!0;g()}else if(t(this).val(""),t(e).data("settings").allowTabOut)return!0;n.stopPropagation(),n.preventDefault()}return!1;case o.ESCAPE:return y(),!0;default:String.fromCharCode(n.which)&&setTimeout(function(){P()},5)}});l.placeholder&&z.attr("placeholder",l.placeholder);var G=t(e).hide().val("").focus(function(){j(z)}).blur(function(){return z.blur(),G}),U=null,W=0,q=null,K=t("<ul />").addClass(t(e).data("settings").classes.tokenList).click(function(e){var n=t(e.target).closest("li");n&&n.get(0)&&t.data(n.get(0),"tokeninput")?v(n):(U&&k(t(U),i.END),j(z))}).mouseover(function(n){var a=t(n.target).closest("li");a&&U!==this&&a.addClass(t(e).data("settings").classes.highlightedToken)}).mouseout(function(n){var a=t(n.target).closest("li");a&&U!==this&&a.removeClass(t(e).data("settings").classes.highlightedToken)}).insertBefore(G),$=t("<li />").addClass(t(e).data("settings").classes.inputToken).appendTo(K).append(z),Q=t("<div/>").addClass(t(e).data("settings").classes.dropdown).appendTo("body").hide(),J=t("<tester/>").insertAfter(z).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:z.css("fontSize"),fontFamily:z.css("fontFamily"),fontWeight:z.css("fontWeight"),letterSpacing:z.css("letterSpacing"),whiteSpace:"nowrap"});G.val("");var X=t(e).data("settings").prePopulate||G.data("pre");t(e).data("settings").processPrePopulate&&t.isFunction(t(e).data("settings").onResult)&&(X=t(e).data("settings").onResult.call(G,X)),X&&X.length&&t.each(X,function(t,e){p(e),u(),z.attr("placeholder",null)}),t(e).data("settings").disabled&&r(!0),"function"==typeof t(e).data("settings").onReady&&t(e).data("settings").onReady.call(),this.clear=function(){K.children("li").each(function(){0===t(this).children("input").length&&m(t(this))})},this.add=function(t){h(t)},this.remove=function(e){K.children("li").each(function(){if(0===t(this).children("input").length){var n=t(this).data("tokeninput"),a=!0;for(var s in e)if(e[s]!==n[s]){a=!1;break}a&&m(t(this))}})},this.getTokens=function(){return H},this.toggleDisabled=function(t){r(t)},c();var Y=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},t.TokenList.Cache=function(e){var n,a,s={},i=0;n=t.extend({max_size:500},e),a=function(){s={},i=0},this.add=function(t,e){i>n.max_size&&a(),s[t]||(i+=1),s[t]=e},this.get=function(t){return s[t]}}}(jQuery);
